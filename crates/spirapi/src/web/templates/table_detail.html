{% extends "base.html" %}

{% block title %}{{ table_name }} - SpiraPiWeb 2025{% endblock %}

{% block content %}
<div class="space-y-6" x-data="{ 
    showInsertModal: false,
    showEditModal: false,
    showViewModal: false,
    showSchemaModal: false,
    newRecord: {},
    editingRecord: {},
    viewingRecord: {},
    selectedFields: [],
    schemaFields: [],
    
    init() {
        // Initialize with default fields
        this.selectedFields = ['id', 'created_at', 'updated_at'];
        this.newRecord = {
            id: 'π-' + Math.random().toString(36).substr(2, 9),
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString()
        };
        
        // Load schema fields for dynamic form generation
        this.loadSchemaFields();
        this.loadTableData();
        
        // Force refresh of schema display after a short delay
        setTimeout(() => {
            this.loadSchemaFields();
        }, 1000);
    },
    
    loadSchemaFields() {
        // Load current schema fields for form generation
        fetch(`/api/tables/{{ table_name }}/schema`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                this.schemaFields = data.fields || [];
                // Initialize newRecord with empty values for schema fields
                this.schemaFields.forEach(field => {
                    this.newRecord[field.name] = '';
                });
                console.log('Schema fields loaded:', this.schemaFields);
            }
        })
        .catch(error => {
            console.error('Error loading schema fields:', error);
        });
    },
    
    openSchemaEditor() {
        // Load current schema fields
        fetch(`/api/tables/{{ table_name }}/schema`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                this.schemaFields = data.fields || [];
                this.showSchemaModal = true;
            }
        })
        .catch(error => {
            console.error('Error loading schema:', error);
            alert('Error loading schema');
        });
    },
    
         saveSchemaChanges() {
         const formData = new FormData();
         formData.append('fields', JSON.stringify(this.schemaFields));
         
         fetch(`/api/tables/{{ table_name }}/schema`, {
             method: 'PUT',
             body: formData
         })
         .then(response => response.json())
         .then(data => {
             if (data.status === 'success') {
                 this.showSchemaModal = false;
                 // Force page refresh to show schema changes immediately
                 location.reload();
             } else {
                 alert('Error: ' + data.message);
             }
         })
         .catch(error => {
             console.error('Error:', error);
             alert('Error saving schema changes');
         });
     },
    
    async loadTableData() {
        try {
            const response = await fetch('/api/tables/{{ table_name }}/data');
            const result = await response.json();
            if (result.status === 'success') {
                // Update the page with real data
                this.updateTableDisplay(result.data);
            }
        } catch (error) {
            console.error('Error loading table data:', error);
        }
    },
    
    updateTableDisplay(data) {
        // This will be handled by the server-side rendering
        // For now, we'll just log the data
        console.log('Table data loaded:', data);
    },
    
         insertRecord() {
         // Prepare data for insertion with dynamic schema fields
         const recordData = {};
         
         // Add dynamic schema fields (only non-empty values)
         this.schemaFields.forEach(field => {
             if (this.newRecord[field.name] !== undefined && this.newRecord[field.name] !== '') {
                 recordData[field.name] = this.newRecord[field.name];
             }
         });
         
         // Add ID if provided
         if (this.newRecord.id && this.newRecord.id.trim() !== '') {
             recordData.id = this.newRecord.id;
         }
         
         // Create form data
         const formData = new FormData();
         formData.append('record_data', JSON.stringify(recordData));
         
         // Send to API
         fetch('/api/tables/{{ table_name }}/data', {
             method: 'POST',
             body: formData
         })
         .then(response => response.json())
         .then(data => {
             if (data.status === 'success') {
                 // Success - close modal and reload
                 this.showInsertModal = false;
                 this.newRecord = {
                     id: 'π-' + Math.random().toString(36).substr(2, 9),
                     created_at: new Date().toISOString(),
                     updated_at: new Date().toISOString()
                 };
                 // Reinitialize schema fields
                 this.schemaFields.forEach(field => {
                     this.newRecord[field.name] = '';
                 });
                 location.reload();
             } else {
                 alert('Error: ' + data.message);
             }
         })
         .catch(error => {
             console.error('Error:', error);
             alert('Error inserting record');
         });
     },
    
    viewRecord(record) {
        this.viewingRecord = record;
        this.showViewModal = true;
    },
    
    editRecord(record) {
        this.editingRecord = { ...record };
        this.showEditModal = true;
    },
    
    updateRecord() {
        if (!this.editingRecord.id) return;
        
        const formData = new FormData();
        formData.append('record_data', JSON.stringify(this.editingRecord));
        
        fetch(`/api/tables/{{ table_name }}/data/${this.editingRecord.id}`, {
            method: 'PUT',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                this.showEditModal = false;
                this.editingRecord = {};
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error updating record');
        });
    },
    
    deleteRecord(recordId) {
        if (confirm('Are you sure you want to delete this record?')) {
            fetch(`/api/tables/{{ table_name }}/data/${recordId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    location.reload();
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error deleting record');
            });
        }
    },
    
    exportData(format = 'json') {
        const url = `/api/export/{{ table_name }}?format=${format}`;
        if (format === 'csv') {
            // For CSV, trigger download
            const link = document.createElement('a');
            link.href = url;
            link.download = `{{ table_name }}_export.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        } else {
            // For JSON, open in new tab
            window.open(url, '_blank');
        }
    }
}">
    
    <!-- Header Section -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-slate-900 dark:text-white">{{ table_name }}</h1>
            <p class="text-slate-600 dark:text-slate-400 mt-2">Table details and data management</p>
        </div>
        <div class="flex items-center space-x-3">
            <button @click="showInsertModal = true" 
                    class="inline-flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-xl transition-all duration-200 hover:scale-105 shadow-lg hover:shadow-xl">
                <i class="w-5 h-5 mr-2" data-lucide="plus"></i>
                Insert Record
            </button>
        </div>
    </div>

    <!-- Table Overview -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- Schema Information -->
        <div class="lg:col-span-1 space-y-6">
            
            <!-- Table Schema -->
            <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 card-shadow">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Table Schema</h3>
                
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                        <span class="text-sm text-slate-600 dark:text-slate-400">Table Name</span>
                        <span class="text-sm font-medium text-slate-900 dark:text-white">{{ table_name }}</span>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                        <span class="text-sm text-slate-600 dark:text-slate-400">Version</span>
                        <span class="text-sm font-medium text-slate-900 dark:text-white">{{ schema.version if schema else '1' }}</span>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                        <span class="text-sm text-slate-600 dark:text-slate-400">Total Fields</span>
                        <span class="text-sm font-medium text-slate-900 dark:text-white">{{ schema.fields|length if schema else '0' }}</span>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                        <span class="text-sm text-slate-600 dark:text-slate-400">Total Records</span>
                        <span class="text-sm font-medium text-slate-900 dark:text-white">{{ total_records }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Field Definitions -->
            <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 card-shadow">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Field Definitions</h3>
                    <button @click="openSchemaEditor()" 
                            class="inline-flex items-center px-3 py-1.5 text-sm bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors">
                        <i class="w-4 h-4 mr-1" data-lucide="edit-3"></i>
                        Edit Schema
                    </button>
                </div>
                
                {% if schema and schema.fields %}
                <div class="space-y-3">
                    {% for field in schema.fields %}
                    <div class="p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg border border-slate-200 dark:border-slate-600">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-medium text-slate-900 dark:text-white">{{ field.name }}</span>
                            <span class="inline-flex items-center px-2 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400 text-xs font-medium rounded-full">
                                {{ field.field_type.name }}
                            </span>
                        </div>
                        
                        <div class="text-sm text-slate-600 dark:text-slate-400 mb-2">
                            {{ field.description or 'No description' }}
                        </div>
                        
                        <div class="flex items-center space-x-2 text-xs text-slate-500 dark:text-slate-400">
                            {% if field.is_required %}
                            <span class="inline-flex items-center px-1.5 py-0.5 bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-400 rounded">
                                Required
                            </span>
                            {% endif %}
                            
                            {% if field.is_unique %}
                            <span class="inline-flex items-center px-1.5 py-0.5 bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-400 rounded">
                                Unique
                            </span>
                            {% endif %}
                            
                            {% if field.default_value %}
                            <span class="inline-flex items-center px-1.5 py-0.5 bg-purple-100 dark:bg-purple-900/20 text-purple-700 dark:text-purple-400 rounded">
                                Default: {{ field.default_value }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8 text-slate-500 dark:text-slate-400">
                    <i class="w-8 h-8 mx-auto mb-2" data-lucide="alert-circle"></i>
                    <p>No schema information available</p>
                </div>
                {% endif %}
            </div>
            
            <!-- Quick Actions -->
            <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 card-shadow">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Quick Actions</h3>
                
                <div class="space-y-3">
                    <button @click="showInsertModal = true" 
                            class="w-full inline-flex items-center justify-center px-4 py-2 bg-green-100 dark:bg-green-900/20 hover:bg-green-200 dark:hover:bg-green-800/30 text-green-700 dark:text-green-400 font-medium rounded-lg transition-colors">
                        <i class="w-4 h-4 mr-2" data-lucide="plus"></i>
                        Insert Record
                    </button>
                    
                    <button @click="exportData('csv')" 
                            class="w-full inline-flex items-center justify-center px-4 py-2 bg-blue-100 dark:bg-blue-900/20 hover:bg-blue-200 dark:hover:bg-blue-800/30 text-blue-700 dark:text-blue-400 font-medium rounded-lg transition-colors">
                        <i class="w-4 h-4 mr-2" data-lucide="download"></i>
                        Export CSV
                    </button>
                    
                    <button @click="exportData('json')" 
                            class="w-full inline-flex items-center justify-center px-4 py-2 bg-purple-100 dark:bg-purple-900/20 hover:bg-purple-200 dark:hover:bg-purple-800/30 text-purple-700 dark:text-purple-400 font-medium rounded-lg transition-colors">
                        <i class="w-4 h-4 mr-2" data-lucide="file-json"></i>
                        Export JSON
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Data Display -->
        <div class="lg:col-span-2 space-y-6">
            
            <!-- Data Table -->
            <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 card-shadow">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Table Data</h3>
                    <span class="text-sm text-slate-500 dark:text-slate-400">{{ total_records }} records</span>
                </div>
                
                {% if table_data %}
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-slate-200 dark:border-slate-700">
                                <th class="text-left py-3 px-4 font-medium text-slate-700 dark:text-slate-300">ID</th>
                                <th class="text-left py-3 px-4 font-medium text-slate-700 dark:text-slate-300">Data</th>
                                <th class="text-left py-3 px-4 font-medium text-slate-700 dark:text-slate-300">Created</th>
                                <th class="text-left py-3 px-4 font-medium text-slate-700 dark:text-slate-300">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for record in table_data %}
                            <tr class="border-b border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/50">
                                <td class="py-3 px-4">
                                    <code class="text-blue-600 dark:text-blue-400 font-mono text-xs">{{ record.id or 'N/A' }}</code>
                                </td>
                                <td class="py-3 px-4 text-slate-700 dark:text-slate-300">
                                    {{ record.data or record.name or 'No data' }}
                                </td>
                                <td class="py-3 px-4 text-slate-600 dark:text-slate-400">
                                    {{ record.created_at or 'N/A' }}
                                </td>
                                <td class="py-3 px-4">
                                    <div class="flex space-x-2">
                                        <button @click="viewRecord({{ record|tojson }})" 
                                                class="inline-flex items-center px-2 py-1 bg-blue-100 dark:bg-blue-900/20 hover:bg-blue-200 dark:hover:bg-blue-800/30 text-blue-700 dark:text-blue-400 text-xs font-medium rounded transition-colors">
                                            <i class="w-3 h-3 mr-1" data-lucide="eye"></i>
                                            View
                                        </button>
                                        <button @click="editRecord({{ record|tojson }})" 
                                                class="inline-flex items-center px-2 py-1 bg-yellow-100 dark:bg-yellow-900/20 hover:bg-yellow-200 dark:hover:bg-yellow-800/30 text-yellow-700 dark:text-yellow-400 text-xs font-medium rounded transition-colors">
                                            <i class="w-3 h-3 mr-1" data-lucide="edit"></i>
                                            Edit
                                        </button>
                                        <button @click="deleteRecord('{{ record.id }}')" 
                                                class="inline-flex items-center px-2 py-1 bg-red-100 dark:bg-red-900/20 hover:bg-red-200 dark:hover:bg-red-800/30 text-red-700 dark:text-red-400 text-xs font-medium rounded transition-colors">
                                            <i class="w-3 h-3 mr-1" data-lucide="trash-2"></i>
                                            Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-12">
                    <div class="w-16 h-16 bg-slate-100 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="w-8 h-8 text-slate-400" data-lucide="database"></i>
                    </div>
                    <h4 class="text-lg font-medium text-slate-900 dark:text-white mb-2">No data yet</h4>
                    <p class="text-slate-600 dark:text-slate-400 mb-4">This table is empty. Insert your first record to get started.</p>
                    <button @click="showInsertModal = true" 
                            class="inline-flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-xl transition-all duration-200 hover:scale-105">
                        <i class="w-5 h-5 mr-2" data-lucide="plus"></i>
                        Insert First Record
                    </button>
                </div>
                {% endif %}
            </div>
            
            <!-- Table Statistics -->
            <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 card-shadow">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Table Statistics</h3>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="text-center p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ total_records }}</div>
                        <div class="text-sm text-slate-600 dark:text-slate-400">Total Records</div>
                    </div>
                    
                    <div class="text-center p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                        <div class="text-2xl font-bold text-green-600 dark:text-green-400">{{ schema.fields|length if schema else 0 }}</div>
                        <div class="text-sm text-slate-600 dark:text-slate-400">Fields</div>
                    </div>
                    
                    <div class="text-center p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                        <div class="text-2xl font-bold text-purple-600 dark:text-purple-400">0 KB</div>
                        <div class="text-sm text-slate-600 dark:text-slate-400">Size</div>
                    </div>
                    
                    <div class="text-center p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                        <div class="text-2xl font-bold text-orange-600 dark:text-orange-400">0%</div>
                        <div class="text-sm text-slate-600 dark:text-slate-400">Growth Rate</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Insert Record Modal -->
    <div x-show="showInsertModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto" 
         style="display: none;">
        
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" @click="showInsertModal = false"></div>
            
            <!-- Modal panel -->
            <div class="inline-block align-bottom bg-white dark:bg-slate-800 rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full"
                 @click.stop>
                
                <!-- Modal header -->
                <div class="bg-green-50 dark:bg-green-900/20 px-6 py-4 border-b border-green-200 dark:border-green-700">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-green-900 dark:text-green-100">Insert New Record</h3>
                        <button @click="showInsertModal = false" 
                                class="text-green-400 hover:text-green-600 dark:hover:text-green-300 transition-colors">
                            <i class="w-5 h-5" data-lucide="x"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Modal body -->
                <div class="px-6 py-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                Record ID
                            </label>
                            <input type="text" 
                                   x-model="newRecord.id"
                                   class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-500 dark:placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 font-mono"
                                   placeholder="π-14159265358979323846">
                            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">π-based identifier (auto-generated)</p>
                        </div>
                        
                        <!-- Dynamic Schema Fields -->
                        <template x-for="field in schemaFields" :key="field.name">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                    <span x-text="field.name"></span>
                                    <span x-show="field.required" class="text-red-500 ml-1">*</span>
                                </label>
                                
                                <!-- String/Text fields -->
                                <input x-show="field.type === 'STRING'" 
                                       type="text" 
                                       x-model="newRecord[field.name]"
                                       class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-500 dark:placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                       :placeholder="'Enter ' + field.name">
                                
                                <!-- Number fields -->
                                <input x-show="field.type === 'INTEGER' || field.type === 'FLOAT'" 
                                       type="number" 
                                       x-model="newRecord[field.name]"
                                       class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-500 dark:placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                       :placeholder="'Enter ' + field.name"
                                       :step="field.type === 'FLOAT' ? '0.01' : '1'">
                                
                                <!-- Boolean fields -->
                                <select x-show="field.type === 'BOOLEAN'" 
                                        x-model="newRecord[field.name]"
                                        class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                                    <option value="">Select...</option>
                                    <option value="true">True</option>
                                    <option value="false">False</option>
                                </select>
                                
                                <!-- DateTime fields -->
                                <input x-show="field.type === 'DATETIME'" 
                                       type="datetime-local" 
                                       x-model="newRecord[field.name]"
                                       class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                                
                                <!-- JSON fields -->
                                <textarea x-show="field.type === 'JSON'" 
                                          x-model="newRecord[field.name]"
                                          rows="3"
                                          class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-500 dark:placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                          :placeholder="'Enter JSON for ' + field.name"></textarea>
                            </div>
                        </template>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                    Created At
                                </label>
                                <input type="datetime-local" 
                                       x-model="newRecord.created_at"
                                       class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                    Updated At
                                </label>
                                <input type="datetime-local" 
                                       x-model="newRecord.updated_at"
                                       class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal footer -->
                <div class="bg-green-50 dark:bg-green-900/20 px-6 py-4 border-t border-green-200 dark:border-green-700">
                    <div class="flex justify-end space-x-3">
                        <button @click="showInsertModal = false" 
                                class="px-4 py-2 text-slate-700 dark:text-slate-300 bg-white dark:bg-slate-600 border border-slate-300 dark:border-slate-500 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-500 transition-colors">
                            Cancel
                        </button>
                        <button @click="insertRecord()" 
                                class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors">
                            Insert Record
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- View Record Modal -->
    <div x-show="showViewModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto" 
         style="display: none;">
        
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" @click="showViewModal = false"></div>
            
            <!-- Modal panel -->
            <div class="inline-block align-bottom bg-white dark:bg-slate-800 rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full"
                 @click.stop>
                
                <!-- Modal header -->
                <div class="bg-blue-50 dark:bg-blue-900/20 px-6 py-4 border-b border-blue-200 dark:border-blue-700">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-blue-900 dark:text-blue-100">View Record</h3>
                        <button @click="showViewModal = false" 
                                class="text-blue-400 hover:text-blue-600 dark:hover:text-blue-300 transition-colors">
                            <i class="w-5 h-5" data-lucide="x"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Modal body -->
                <div class="px-6 py-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                Record ID
                            </label>
                            <code class="block w-full px-4 py-3 bg-slate-100 dark:bg-slate-700 rounded-lg text-slate-900 dark:text-white font-mono text-sm" x-text="viewingRecord.id || 'N/A'"></code>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                Data
                            </label>
                            <div class="w-full px-4 py-3 bg-slate-100 dark:bg-slate-700 rounded-lg text-slate-900 dark:text-white min-h-[4rem] border border-slate-200 dark:border-slate-600" x-text="viewingRecord.data || 'No data'"></div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                    Created At
                                </label>
                                <div class="w-full px-4 py-3 bg-slate-100 dark:bg-slate-700 rounded-lg text-slate-900 dark:text-white" x-text="viewingRecord.created_at || 'N/A'"></div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                    Updated At
                                </label>
                                <div class="w-full px-4 py-3 bg-slate-100 dark:bg-slate-700 rounded-lg text-slate-900 dark:text-white" x-text="viewingRecord.updated_at || 'N/A'"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal footer -->
                <div class="bg-blue-50 dark:bg-blue-900/20 px-6 py-4 border-t border-blue-200 dark:border-blue-700">
                    <div class="flex justify-end space-x-3">
                        <button @click="showViewModal = false" 
                                class="px-4 py-2 text-slate-700 dark:text-slate-300 bg-white dark:bg-slate-600 border border-slate-300 dark:border-slate-500 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-500 transition-colors">
                            Close
                        </button>
                        <button @click="editRecord(viewingRecord); showViewModal = false" 
                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
                            Edit Record
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Record Modal -->
    <div x-show="showEditModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto" 
         style="display: none;">
        
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" @click="showEditModal = false"></div>
            
            <!-- Modal panel -->
            <div class="inline-block align-bottom bg-white dark:bg-slate-800 rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full"
                 @click.stop>
                
                <!-- Modal header -->
                <div class="bg-yellow-50 dark:bg-yellow-900/20 px-6 py-4 border-b border-yellow-200 dark:border-yellow-700">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-yellow-900 dark:text-yellow-100">Edit Record</h3>
                        <button @click="showEditModal = false" 
                                class="text-yellow-400 hover:text-yellow-600 dark:hover:text-yellow-300 transition-colors">
                            <i class="w-5 h-5" data-lucide="x"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Modal body -->
                <div class="px-6 py-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                Record ID
                            </label>
                            <input type="text" 
                                   x-model="editingRecord.id"
                                   class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-white font-mono text-sm"
                                   readonly>
                            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Record ID cannot be changed</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                Data
                            </label>
                            <textarea x-model="editingRecord.data"
                                      rows="4"
                                      class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-500 dark:placeholder-slate-400 focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-200"
                                      placeholder="Enter record data..."></textarea>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                    Created At
                                </label>
                                <input type="datetime-local" 
                                       x-model="editingRecord.created_at"
                                       class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-200">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                    Updated At
                                </label>
                                <input type="datetime-local" 
                                       x-model="editingRecord.updated_at"
                                       class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-200">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal footer -->
                <div class="bg-yellow-50 dark:bg-yellow-900/20 px-6 py-4 border-t border-yellow-200 dark:border-yellow-700">
                    <div class="flex justify-end space-x-3">
                        <button @click="showEditModal = false" 
                                class="px-4 py-2 text-slate-700 dark:text-slate-300 bg-white dark:bg-slate-600 border border-slate-300 dark:border-slate-500 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-500 transition-colors">
                            Cancel
                        </button>
                        <button @click="updateRecord()" 
                                class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white font-medium rounded-lg transition-colors">
                            Update Record
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Schema Editor Modal -->
    <div x-show="showSchemaModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto" 
         style="display: none;">
        
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" @click="showSchemaModal = false"></div>
            
            <!-- Modal panel -->
            <div class="inline-block align-bottom bg-white dark:bg-slate-800 rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"
                 @click.stop>
                
                <!-- Modal header -->
                <div class="bg-purple-50 dark:bg-purple-900/20 px-6 py-4 border-b border-purple-200 dark:border-purple-700">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-purple-900 dark:text-purple-100">Edit Table Schema</h3>
                        <button @click="showSchemaModal = false" 
                                class="text-purple-400 hover:text-purple-600 dark:hover:text-purple-300 transition-colors">
                            <i class="w-5 h-5" data-lucide="x"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Modal body -->
                <div class="px-6 py-6">
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <h4 class="text-md font-medium text-slate-700 dark:text-slate-300">Custom Fields</h4>
                            <button @click="schemaFields.push({name: '', type: 'STRING', required: false, unique: false})" 
                                    class="inline-flex items-center px-3 py-1.5 text-sm bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                <i class="w-4 h-4 mr-1" data-lucide="plus"></i>
                                Add Field
                            </button>
                        </div>
                        
                        <div class="space-y-3">
                            <template x-for="(field, index) in schemaFields" :key="index">
                                <div class="p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg border border-slate-200 dark:border-slate-600">
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Field Name</label>
                                            <input type="text" 
                                                   x-model="field.name"
                                                   class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm"
                                                   placeholder="field_name">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Type</label>
                                            <select x-model="field.type"
                                                    class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm">
                                                <option value="STRING">String</option>
                                                <option value="INTEGER">Integer</option>
                                                <option value="FLOAT">Float</option>
                                                <option value="BOOLEAN">Boolean</option>
                                                <option value="DATETIME">DateTime</option>
                                                <option value="JSON">JSON</option>
                                            </select>
                                        </div>
                                        
                                        <div class="flex items-center space-x-3">
                                            <label class="flex items-center">
                                                <input type="checkbox" 
                                                       x-model="field.required"
                                                       class="rounded border-slate-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-slate-700 dark:text-slate-300">Required</span>
                                            </label>
                                            
                                            <label class="flex items-center">
                                                <input type="checkbox" 
                                                       x-model="field.unique"
                                                       class="rounded border-slate-300 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-slate-700 dark:text-slate-300">Unique</span>
                                            </label>
                                        </div>
                                        
                                        <div class="flex items-center justify-end">
                                            <button @click="schemaFields.splice(index, 1)" 
                                                    class="group relative inline-flex items-center justify-center w-8 h-8 text-red-500 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-full transition-all duration-200 hover:scale-110 border border-red-200 dark:border-red-700">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                                </svg>
                                                <span class="absolute -top-8 left-1/2 transform -translate-x-1/2 px-2 py-1 text-xs text-white bg-gray-800 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap">
                                                    Delete Field
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            
                            <div x-show="schemaFields.length === 0" class="text-center py-8 text-slate-500 dark:text-slate-400">
                                <i class="w-8 h-8 mx-auto mb-2" data-lucide="database"></i>
                                <p>No custom fields defined</p>
                                <p class="text-sm">Click "Add Field" to start building your schema</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal footer -->
                <div class="bg-purple-50 dark:bg-purple-900/20 px-6 py-4 border-t border-purple-200 dark:border-purple-700">
                    <div class="flex justify-end space-x-3">
                        <button @click="showSchemaModal = false" 
                                class="px-4 py-2 text-slate-700 dark:text-slate-300 bg-white dark:bg-slate-600 border border-slate-300 dark:border-slate-500 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-500 transition-colors">
                            Cancel
                        </button>
                        <button @click="saveSchemaChanges()" 
                                class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors">
                            Save Schema Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
